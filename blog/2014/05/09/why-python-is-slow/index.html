<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Jake VanderPlas">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>Why Python is Slow: Looking Under the Hood | Pythonic Perambulations</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="alternate" type="application/atom+xml" title="Pythonic Perambulations blog atom feed" href="/feeds/all.atom.xml" />
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="/theme/css/icons.css"/>
        <style>.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #60a0b0; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #007020; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #60a0b0; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #007020 } /* Comment.Preproc */
.highlight .c1 { color: #60a0b0; font-style: italic } /* Comment.Single */
.highlight .cs { color: #60a0b0; background-color: #fff0f0 } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #007020; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #007020; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #007020; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #007020 } /* Keyword.Pseudo */
.highlight .kr { color: #007020; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #902000 } /* Keyword.Type */
.highlight .m { color: #40a070 } /* Literal.Number */
.highlight .s { color: #4070a0 } /* Literal.String */
.highlight .na { color: #4070a0 } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #0e84b5; font-weight: bold } /* Name.Class */
.highlight .no { color: #60add5 } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #d55537; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #007020 } /* Name.Exception */
.highlight .nf { color: #06287e } /* Name.Function */
.highlight .nl { color: #002070; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #062873; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #bb60d5 } /* Name.Variable */
.highlight .ow { color: #007020; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #40a070 } /* Literal.Number.Float */
.highlight .mh { color: #40a070 } /* Literal.Number.Hex */
.highlight .mi { color: #40a070 } /* Literal.Number.Integer */
.highlight .mo { color: #40a070 } /* Literal.Number.Oct */
.highlight .sb { color: #4070a0 } /* Literal.String.Backtick */
.highlight .sc { color: #4070a0 } /* Literal.String.Char */
.highlight .sd { color: #4070a0; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #4070a0 } /* Literal.String.Double */
.highlight .se { color: #4070a0; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #4070a0 } /* Literal.String.Heredoc */
.highlight .si { color: #70a0d0; font-style: italic } /* Literal.String.Interpol */
.highlight .sx { color: #c65d09 } /* Literal.String.Other */
.highlight .sr { color: #235388 } /* Literal.String.Regex */
.highlight .s1 { color: #4070a0 } /* Literal.String.Single */
.highlight .ss { color: #517918 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #bb60d5 } /* Name.Variable.Class */
.highlight .vg { color: #bb60d5 } /* Name.Variable.Global */
.highlight .vi { color: #bb60d5 } /* Name.Variable.Instance */
.highlight .il { color: #40a070 } /* Literal.Number.Integer.Long */</style>
        <style>body {
  margin: 0;
  padding: 0;
  font: 15px 'Source Sans Pro', sans-serif;
  line-height: 1.6em;
  color: #222;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
}
a {
  color: #007EE5;
  text-decoration: none;
}
a:hover {
  color: #007EE5;
  text-decoration: none;
}
header.main-header {
  background: none repeat scroll 0% 0% #205F29;
  margin-bottom: 0px;
}
header.main-header a {
  color: #fff;
}
header.main-header .container {
  max-width: 1000px;
}
header.main-header .container nav a:hover {
  background-color: #5C881C;
}
article {
  margin: 0;
}
article header.about {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
article header {
  margin-bottom: 20px;
  padding-bottom: 20px;
}
article header h1 {
  margin-bottom: 2px;
  font-weight: 700;
  color: #000;
}
article header time {
  color: #9E9E9E;
  font-size: 0.85em;
  float: right;
}
article header time.left {
  color: #9E9E9E;
  font-size: 0.85em;
  float: left;
}
article div.social-links ul {
  padding: 0px;
}
article div.social-links li {
  display: inline;
  font-size: 20px;
}
article div.social-links li a {
  color: #000;
  padding: 10px;
}
article div.social-links li a:hover {
  color: #666;
  text-decoration: none;
}
article p {
  font-size: 16px;
  margin-bottom: 20px;
  line-height: 1.6em;
}
article p.note {
  background: #f5f5f5;
  border: 1px solid #ddd;
  padding: 0.533em 0.733em;
}
article p.update {
  background-color: #FEEFB3;
  border: 1px solid #e6e68a;
  padding: 0.533em 0.733em;
}
article p.alert {
  background-color: #ffe2e2;
  border: 1px solid #ffb2b2;
  padding: 0.533em 0.733em;
}
article ul,
article ol {
  margin-top: 0px;
  margin-bottom: 25px;
}
article li {
  font-size: 16px;
  line-height: 1.6em;
}
article a:hover {
  text-decoration: underline;
}
article blockquote {
  border-left: 2px solid #c7c7cc;
  color: #666;
  margin: 30px 0;
  padding: 0 0 0 25px;
}
article img {
  max-width: 100%;
}
article code {
  color: #333;
  background-color: #EEE;
  border-radius: 0;
  font-size: 13px;
}
article .meta {
  font-size: 11px;
}
article .meta a:hover {
  text-decoration: none;
}
article .meta div {
  margin-bottom: 20px;
  display: block;
}
article .meta a.tag {
  margin: 0 10px 10px 0;
  padding: 1px 12px;
  display: inline-block;
  font-size: 14px;
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.05);
}
article .meta a.tag:hover {
  background: rgba(0, 0, 0, 0.15);
}
article .meta a.read_more,
article .meta a.comments_btn {
  font-size: 14px;
  font-weight: 800;
  padding: 10px 20px;
  color: #205F29;
  background: #FFF;
  border: 1px solid #205F29;
}
article .meta a.read_more:hover,
article .meta a.comments_btn:hover {
  color: #FFF;
  background: #5C881C;
}
.index {
  max-width: 700px;
}
.index article header h2 {
  font-size: 36px;
  margin-bottom: 2px;
  font-weight: 700;
}
.index article header h2 a {
  color: #000;
}
.index article header h2 a:hover {
  color: #007EE5;
  text-decoration: none;
}
.index .separator {
  padding: 40px 0 0 0;
  margin: 0 0 40px 0;
  height: 10px;
  border-bottom: solid 1px #CCC;
}
.index .pagination {
  display: block;
  margin-bottom: 100px;
}
.index .pagination .left {
  text-align: right;
}
.index .pagination .right {
  text-align: left;
}
.index .pagination a {
  display: inline-block;
  border: 2px solid #5C881C;
  margin: 0 5px;
  padding: 8px 20px;
  font-weight: bold;
  color: #5C881C;
}
.index .pagination a:hover {
  color: #FFF;
  background: #5C881C;
}
.post {
  max-width: 700px;
}
.post h2:before {
  content: "# ";
  font-weight: bold;
  color: #DDD;
}
.post h3:before {
  content: "## ";
  font-weight: bold;
  color: #DDD;
}
.post h4:before {
  content: "### ";
  font-weight: bold;
  color: #DDD;
}
.post article .meta {
  margin: 50px 0 100px;
}
.list {
  max-width: 700px;
}
.list ul.double-list {
  margin: 0 auto 60px;
  padding: 0;
  list-style-type: none;
}
.list ul.double-list li {
  padding: 5px 0;
}
.list ul.double-list li h2 {
  font-size: 1em;
  display: inline;
  font-weight: normal;
}
.list ul.double-list li span {
  font-family: sans-serif;
  text-transform: uppercase;
  text-align: right;
  float: right;
  padding-top: 3px;
  font-size: 12px;
  color: #999;
}
.full-width-content {
  padding-top: 10px;
  padding-left: 0px;
  padding-right: 0px;
  margin-left: -20px;
  margin-right: -20px;
}
.col-xs-1,
.col-sm-1,
.col-md-1,
.col-lg-1,
.col-xs-2,
.col-sm-2,
.col-md-2,
.col-lg-2,
.col-xs-3,
.col-sm-3,
.col-md-3,
.col-lg-3,
.col-xs-4,
.col-sm-4,
.col-md-4,
.col-lg-4,
.col-xs-5,
.col-sm-5,
.col-md-5,
.col-lg-5,
.col-xs-6,
.col-sm-6,
.col-md-6,
.col-lg-6,
.col-xs-7,
.col-sm-7,
.col-md-7,
.col-lg-7,
.col-xs-8,
.col-sm-8,
.col-md-8,
.col-lg-8,
.col-xs-9,
.col-sm-9,
.col-md-9,
.col-lg-9,
.col-xs-10,
.col-sm-10,
.col-md-10,
.col-lg-10,
.col-xs-11,
.col-sm-11,
.col-md-11,
.col-lg-11,
.col-xs-12,
.col-sm-12,
.col-md-12,
.col-lg-12 {
  padding-right: 0px;
  padding-left: 0px;
}</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
        <script type="text/javascript">
        init_mathjax = function() {
            if (window.MathJax) {
                // MathJax loaded
                MathJax.Hub.Config({
                    tex2jax: {
                        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                        displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
                    },
                    displayAlign: 'left', // Change this to 'center' to center equations.
                    "HTML-CSS": {
                        styles: {'.MathJax_Display': {"margin": 0}}
                    }
                });
                MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            }
        }
        init_mathjax();
        </script>

    </head>

    <body>
        <header class="navbar navbar-inverse bs-docs-nav">
            <div class="container-fluid">
                <div class="navbar-header">
		  <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#theNavbar">
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span>
		    <span class="icon-bar"></span> 
		  </button>
                  <a class="navbar-brand" href="/" title="Home" class="title">Pythonic Perambulations</a>
                </div>
                <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation" id="theNavbar">
		    <ul class="nav navbar-nav navbar-right">
                            <li><a href="/pages/about.html" title="About">About</a></li>
                            <li><a href="/archives.html" title="Archive">Archive</a></li>
                            <li><a class="nodec icon-rss" href="/feeds/all.atom.xml" title="jakevdp.github.io RSS feed" rel="me"></a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div id="wrap">
<div class="container post">
    <article>
        <header>
            <h1>Why Python is Slow: Looking Under the Hood</h1>
            <time datetime="article.date.isoformat()" pubdate>Fri 09 May 2014</time>
        </header>

        <div class="article_content">
            <style type="text/css">/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI colors. */
.ansibold {
  font-weight: bold;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  border-left-width: 1px;
  padding-left: 5px;
  background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%);
}
div.cell.jupyter-soft-selected {
  border-left-color: #90CAF9;
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected {
  border-color: #ababab;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%);
}
@media print {
  div.cell.selected {
    border-color: transparent;
  }
}
div.cell.selected.jupyter-soft-selected {
  border-left-width: 0;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%);
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%);
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  padding: 0.4em;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */
  /* .CodeMirror-lines */
  padding: 0;
  border: 0;
  border-radius: 0;
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}


.rendered_html pre,



.rendered_html tr,
.rendered_html th,

.rendered_html td,


.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,

div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
</style>
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
<style type="text/css">
/* Temporary definitions which will become obsolete with Notebook release 5.0 */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We've all heard it before: Python is slow.</p>
<p>When I teach courses on Python for scientific computing, I make this point <a href="http://nbviewer.ipython.org/github/jakevdp/2013_fall_ASTR599/blob/master/notebooks/11_EfficientNumpy.ipynb">very early</a> in the course, and tell the students why: it boils down to Python being a dynamically typed, interpreted language, where values are stored not in dense buffers but in scattered objects.  And then I talk about how to get around this by using NumPy, SciPy, and related tools for vectorization of operations and calling into compiled code, and go on from there.</p>
<p>But I realized something recently: despite the relative accuracy of the above statements, the words "dynamically-typed-interpreted-buffers-vectorization-compiled" probably mean very little to somebody attending an intro programming seminar. The jargon does little to enlighten people about what's actually going on "under the hood", so to speak.</p>
<p>So I decided I would write this post, and dive into the details that I usually gloss over. Along the way, we'll take a look at using Python's standard library to introspect the goings-on of CPython itself. So whether you're a novice or experienced programmer, I hope you'll learn something from the following exploration.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Why-Python-is-Slow">Why Python is Slow<a class="anchor-link" href="#Why-Python-is-Slow">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Python is slower than Fortran and C for a variety of reasons:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="1.-Python-is-Dynamically-Typed-rather-than-Statically-Typed.">1. <strong>Python is Dynamically Typed rather than Statically Typed</strong>.<a class="anchor-link" href="#1.-Python-is-Dynamically-Typed-rather-than-Statically-Typed.">&#182;</a></h3><p>What this means is that at the time the program executes, the interpreter doesn't know the type of the variables that are defined.  The difference between a C variable (I'm using C as a stand-in for compiled languages) and a Python variable is summarized by this diagram:</p>
<p><img src="http://jakevdp.github.io/images/cint_vs_pyint.png" alt="cint vs pyint"></p>
<p>For a variable in C, the compiler knows the type by its very definition. For a variable in Python, all you know at the time the program executes is that it's some sort of Python object.</p>
<p>So if you write the following in C:</p>
<div class="highlight"><pre><span></span><span class="cm">/* C code */</span>
<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</pre></div>
<p>the C compiler knows from the start that <code>a</code> and <code>b</code> are integers: they simply can't be anything else! With this knowledge, it can call the routine which adds two integers, returning another integer which is just a simple value in memory. As a rough schematic, the sequence of events looks like this:</p>
<h4 id="C-Addition">C Addition<a class="anchor-link" href="#C-Addition">&#182;</a></h4><ol>
<li>Assign <code>&lt;int&gt; 1</code> to <code>a</code></li>
<li>Assign <code>&lt;int&gt; 2</code> to <code>b</code></li>
<li>call <code>binary_add&lt;int, int&gt;(a, b)</code></li>
<li>Assign the result to c</li>
</ol>
<p>The equivalent code in Python looks like this:</p>
<div class="highlight"><pre><span></span><span class="c1"># python code</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
<p>here the interpreter knows only that <code>1</code> and <code>2</code> are objects, but not what type of object they are. So the interpreter must inspect <code>PyObject_HEAD</code> for each variable to find the type information, and then call the appropriate summation routine for the two types. Finally it must create and initialize a new Python object to hold the return value.  The sequence of events looks roughly like this:</p>
<h4 id="Python-Addition">Python Addition<a class="anchor-link" href="#Python-Addition">&#182;</a></h4><ol>
<li><p>Assign <code>1</code> to <code>a</code></p>
<ul>
<li><strong>1a.</strong> Set <code>a-&gt;PyObject_HEAD-&gt;typecode</code> to integer</li>
<li><strong>1b.</strong> Set <code>a-&gt;val = 1</code></li>
</ul>
</li>
<li><p>Assign <code>2</code> to <code>b</code></p>
<ul>
<li><strong>2a.</strong> Set <code>b-&gt;PyObject_HEAD-&gt;typecode</code> to integer</li>
<li><strong>2b.</strong> Set <code>b-&gt;val = 2</code></li>
</ul>
</li>
<li><p>call <code>binary_add(a, b)</code></p>
<ul>
<li><strong>3a.</strong> find typecode in <code>a-&gt;PyObject_HEAD</code></li>
<li><strong>3b.</strong> <code>a</code> is an integer; value is <code>a-&gt;val</code></li>
<li><strong>3c.</strong> find typecode in <code>b-&gt;PyObject_HEAD</code></li>
<li><strong>3d.</strong> <code>b</code> is an integer; value is <code>b-&gt;val</code></li>
<li><strong>3e.</strong> call <code>binary_add&lt;int, int&gt;(a-&gt;val, b-&gt;val)</code></li>
<li><strong>3f.</strong> result of this is <code>result</code>, and is an integer.</li>
</ul>
</li>
<li><p>Create a Python object <code>c</code></p>
<ul>
<li><strong>4a.</strong> set <code>c-&gt;PyObject_HEAD-&gt;typecode</code> to integer</li>
<li><strong>4b.</strong> set <code>c-&gt;val</code> to <code>result</code></li>
</ul>
</li>
</ol>
<p>The dynamic typing means that there are a lot more steps involved with any operation. This is a primary reason that Python is slow compared to C for operations on numerical data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Python-is-interpreted-rather-than-compiled.">2. Python is interpreted rather than compiled.<a class="anchor-link" href="#2.-Python-is-interpreted-rather-than-compiled.">&#182;</a></h3><p>We saw above one difference between interpreted and compiled code. A smart compiler can look ahead and optimize for repeated or unneeded operations, which can result in speed-ups. Compiler optimization is its own beast, and I'm personally not qualified to say much about it, so I'll stop there.  For some examples of this in action, you can take a look at my <a href="http://jakevdp.github.io/blog/2013/06/15/numba-vs-cython-take-2/">previous post</a> on Numba and Cython.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-Python's-object-model-can-lead-to-inefficient-memory-access">3. Python's object model can lead to inefficient memory access<a class="anchor-link" href="#3.-Python's-object-model-can-lead-to-inefficient-memory-access">&#182;</a></h3><p>We saw above the extra type info layer when moving from a C integer to a Python integer. Now imagine you have many such integers and want to do some sort of batch operation on them.  In Python you might use the standard <code>List</code> object, while in C you would likely use some sort of buffer-based array.</p>
<p>A NumPy array in its simplest form is a Python object build around a C array. That is, it has a pointer to a <em>contiguous</em> data buffer of values. A Python list, on the other hand, has a pointer to a contiguous buffer of pointers, each of which points to a Python object which in turn has references to its data (in this case, integers).  This is a schematic of what the two might look like:</p>
<p><img src="http://jakevdp.github.io/images/array_vs_list.png" alt="array vs list"></p>
<p>It's easy to see that if you're doing some operation which steps through data in sequence, the numpy layout will be much more efficient than the Python layout, both in the cost of storage and the cost of access.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="So-Why-Use-Python?">So Why Use Python?<a class="anchor-link" href="#So-Why-Use-Python?">&#182;</a></h3><p>Given this inherent inefficiency, why would we even think about using Python? Well, it comes down to this: Dynamic typing makes Python <strong>easier to use</strong> than C.  It's extremely <strong>flexible and forgiving</strong>, this flexibility leads to <strong>efficient use of development time</strong>, and on those occasions that you really need the optimization of C or Fortran, <strong>Python offers easy hooks into compiled libraries</strong>. It's why Python use within many scientific communities has been continually growing. With all that put together, Python ends up being an extremely efficient language for the overall task of doing science with code.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Python-meta-hacking:-Don't-take-my-word-for-it">Python meta-hacking: Don't take my word for it<a class="anchor-link" href="#Python-meta-hacking:-Don't-take-my-word-for-it">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Above I've talked about some of the internal structures that make Python tick, but I don't want to stop there. As I was putting together the above summary, I started hacking around on the internals of the Python language, and found that the process itself is pretty enlightening.</p>
<p>In the following sections, I'm going to <em>prove</em> to you that the above information is correct, by doing some hacking to expose Python objects using Python itself.  Please note that everything below is written using <strong>Python 3.4</strong>. Earlier versions of Python have a slightly different internal object structure, and later versions may tweak this further. Please make sure to use the correct version!  Also, most of the code below assumes a 64-bit CPU. If you're on a 32-bit platform, some of the C types below will have to be adjusted to account for this difference.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python version =&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Python version = 3.4.0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Digging-into-Python-Integers">Digging into Python Integers<a class="anchor-link" href="#Digging-into-Python-Integers">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Integers in Python are easy to create and use:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>42
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But the simplicity of this interface belies the complexity of what is happening under the hood. We briefly discussed the memory layout of Python integers above.  Here we'll use Python's built-in <code>ctypes</code> module to introspect Python's integer type from the Python interpreter itself.  But first we need to know exactly what a Python integer looks like at the level of the C API.</p>
<p>The actual <code>x</code> variable in CPython is stored in a structure which is defined in the CPython source code, in <a href="http://hg.python.org/cpython/file/3.4/Include/longintrepr.h/#l89">Include/longintrepr.h</a></p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">_longobject</span> <span class="p">{</span>
    <span class="n">PyObject_VAR_HEAD</span>
    <span class="n">digit</span> <span class="n">ob_digit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
<p>The <code>PyObject_VAR_HEAD</code> is a macro which starts the object off with the following struct, defined in <a href="http://hg.python.org/cpython/file/3.4/Include/object.h#l111">Include/object.h</a>:</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject</span> <span class="n">ob_base</span><span class="p">;</span>
    <span class="n">Py_ssize_t</span> <span class="n">ob_size</span><span class="p">;</span> <span class="cm">/* Number of items in variable part */</span>
<span class="p">}</span> <span class="n">PyVarObject</span><span class="p">;</span>
</pre></div>
<p>... and includes a <code>PyObject</code> element, which is also defined in <a href="http://hg.python.org/cpython/file/3.4/Include/object.h#l105">Include/object.h</a>:</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_object</span> <span class="p">{</span>
    <span class="n">_PyObject_HEAD_EXTRA</span>
    <span class="n">Py_ssize_t</span> <span class="n">ob_refcnt</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">_typeobject</span> <span class="o">*</span><span class="n">ob_type</span><span class="p">;</span>
<span class="p">}</span> <span class="n">PyObject</span><span class="p">;</span>
</pre></div>
<p>here <code>_PyObject_HEAD_EXTRA</code> is a macro which is not normally used in the Python build.</p>
<p>With all this put together and typedefs/macros unobfuscated, our integer object works out to something like the following structure:</p>
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">_longobject</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="n">ob_refcnt</span><span class="p">;</span>
    <span class="n">PyTypeObject</span> <span class="o">*</span><span class="n">ob_type</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">ob_size</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">ob_digit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
<p>The <code>ob_refcnt</code> variable is the reference count for the object, the <code>ob_type</code> variable is a pointer to the structure containing all the type information and method definitions for the object, and the <code>ob_digit</code> holds the actual numerical value.</p>
<p>Armed with this knowledge, we'll use the <code>ctypes</code> module to start looking into the actual object structure and extract some of the above information.</p>
<p>We start with defining a Python representation of the C structure:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">ctypes</span>

<span class="k">class</span> <span class="nc">IntStruct</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ob_refcnt&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_type&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_size&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ulong</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_digit&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;IntStruct(ob_digit=</span><span class="si">{self.ob_digit}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;refcount=</span><span class="si">{self.ob_refcnt}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's look at the internal representation for some number, say 42.  We'll use the fact that in CPython, the <code>id</code> function gives the memory location of the object:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">IntStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[4]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>IntStruct(ob_digit=42, refcount=35)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>ob_digit</code> attribute points to the correct location in memory!</p>
<p>But what about <code>refcount</code>? We've only created a single value: why is the reference count so much greater than one?</p>
<p>Well it turns out that Python uses small integers <em>a lot</em>. If a new <code>PyObject</code> were created for each of these integers, it would take a lot of memory. Because of this, Python implements common integer values as <strong>singletons</strong>: that is, only one copy of these numbers exist in memory. In other words, every time you create a new Python integer in this range, you're simply creating a reference to the singleton with that value:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">42</span>
<span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Both variables are simply pointers to the same memory address.  When you get to much bigger integers (larger than 255 in Python 3.4), this is no longer true:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">1234</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">1234</span>
<span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Just starting up the Python interpreter will create a lot of integer objects; it can be interesting to take a look at how many references there are to each:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">getrefcount</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;integer value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;reference count&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.text.Text at 0x106866ac8&gt;</pre>
</div>

</div>

<div class="output_area">

<div class="prompt"></div>




<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see that zero is referenced several thousand times, and as you may expect, the frequency of references generally decreases as the value of the integer increases.</p>
<p>Just to further make sure that this is behaving as we'd expect, let's make sure the <code>ob_digit</code> field holds the correct value:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">all</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">IntStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">ob_digit</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[8]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you go a bit deeper into this, you might notice that this does not hold for numbers larger than 256: it turns out that some bit-shift gymnastics are performed in <a href="http://hg.python.org/cpython/file/3.4/Objects/longobject.c#l232">Objects/longobject.c</a>, and these change the way large integers are represented in memory.</p>
<p>I can't say that I fully understand why exactly that is happening, but I imagine it has something to do with Python's ability to efficiently handle integers past the overflow limit of the long int data type, as we can see here:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">2</span> <span class="o">**</span> <span class="mi">100</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[9]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>1267650600228229401496703205376</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>That number is much too long to be a <code>long</code>, which can only hold 64 bits worth of values (that is, up to $\sim2^{64}$)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Digging-into-Python-Lists">Digging into Python Lists<a class="anchor-link" href="#Digging-into-Python-Lists">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's apply the above ideas to a more complicated type: Python lists. Analogously to integers, we find the definition of the list object itself in <a href="http://hg.python.org/cpython/file/3.4/Include/listobject.h#l23">Include/listobject.h</a>:</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">PyObject_VAR_HEAD</span>
    <span class="n">PyObject</span> <span class="o">**</span><span class="n">ob_item</span><span class="p">;</span>
    <span class="n">Py_ssize_t</span> <span class="n">allocated</span><span class="p">;</span>
<span class="p">}</span> <span class="n">PyListObject</span><span class="p">;</span>
</pre></div>
<p>Again, we can expand the macros and de-obfuscate the types to see that the structure is effectively the following:</p>
<div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">long</span> <span class="n">ob_refcnt</span><span class="p">;</span>
    <span class="n">PyTypeObject</span> <span class="o">*</span><span class="n">ob_type</span><span class="p">;</span>
    <span class="n">Py_ssize_t</span> <span class="n">ob_size</span><span class="p">;</span>
    <span class="n">PyObject</span> <span class="o">**</span><span class="n">ob_item</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">allocated</span><span class="p">;</span>
<span class="p">}</span> <span class="n">PyListObject</span><span class="p">;</span>
</pre></div>
<p>Here the <code>PyObject **ob_item</code> is what points to the contents of the list, and the <code>ob_size</code> value tells us how many items are in the list.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ListStruct</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ob_refcnt&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_type&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_size&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ulong</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_item&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>  <span class="c1"># PyObject** pointer cast to long</span>
                <span class="p">(</span><span class="s2">&quot;allocated&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_ulong</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;ListStruct(len=</span><span class="si">{self.ob_size}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;refcount=</span><span class="si">{self.ob_refcnt}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's try it out:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">ListStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[11]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>ListStruct(len=5, refcount=1)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Just to make sure we've done things correctly, let's create a few extra references to the list, and see how it affects the reference count:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="p">]</span>  <span class="c1"># two more references to L</span>
<span class="n">ListStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[12]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>ListStruct(len=5, refcount=3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's see about finding the actual elements within the list.</p>
<p>As we saw above, the elements are stored via a contiguous array of <code>PyObject</code> pointers.  Using <code>ctypes</code>, we can actually create a compound structure consisting of our <code>IntStruct</code> objects from before:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># get a raw pointer to our list</span>
<span class="n">Lstruct</span> <span class="o">=</span> <span class="n">ListStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>

<span class="c1"># create a type which is an array of integer pointers the same length as L</span>
<span class="n">PtrArray</span> <span class="o">=</span> <span class="n">Lstruct</span><span class="o">.</span><span class="n">ob_size</span> <span class="o">*</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">IntStruct</span><span class="p">)</span>

<span class="c1"># instantiate this type using the ob_item pointer</span>
<span class="n">L_values</span> <span class="o">=</span> <span class="n">PtrArray</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">Lstruct</span><span class="o">.</span><span class="n">ob_item</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's take a look at the values in each of the items:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ptr</span> <span class="ow">in</span> <span class="n">L_values</span><span class="p">]</span>  <span class="c1"># ptr[0] dereferences the pointer</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[14]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[IntStruct(ob_digit=1, refcount=5296),
 IntStruct(ob_digit=2, refcount=2887),
 IntStruct(ob_digit=3, refcount=932),
 IntStruct(ob_digit=4, refcount=1049),
 IntStruct(ob_digit=5, refcount=808)]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We've recovered the <code>PyObject</code> integers within our list! You might wish to take a moment to look back up to the schematic of the List memory layout above, and make sure you understand how these <code>ctypes</code> operations map onto that diagram.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Digging-into-NumPy-arrays">Digging into NumPy arrays<a class="anchor-link" href="#Digging-into-NumPy-arrays">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, for comparison, let's do the same introspection on a numpy array.  I'll skip the detailed walk-through of the NumPy C-API array definition; if you want to take a look at it, you can find it in <a href="https://github.com/numpy/numpy/blob/maintenance/1.8.x/numpy/core/include/numpy/ndarraytypes.h#L646">numpy/core/include/numpy/ndarraytypes.h</a></p>
<p>Note that I'm using NumPy version 1.8 here; these internals may have changed between versions, though I'm not sure whether this is the case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[15]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&#39;1.8.1&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's start by creating a structure that represents the numpy array itself. This should be starting to look familiar...</p>
<p>We'll also add some custom properties to access Python versions of the shape and strides:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">NumpyStruct</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ob_refcnt&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_type&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_data&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>  <span class="c1"># char* pointer cast to long</span>
                <span class="p">(</span><span class="s2">&quot;ob_ndim&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_shape&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_voidp</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_strides&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_voidp</span><span class="p">)]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ob_ndim</span> <span class="o">*</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int64</span><span class="p">)</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ob_shape</span><span class="p">))</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">strides</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ob_ndim</span> <span class="o">*</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int64</span><span class="p">)</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ob_strides</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;NumpyStruct(shape=</span><span class="si">{self.shape}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;refcount=</span><span class="si">{self.ob_refcnt}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's try it out:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">xstruct</span> <span class="o">=</span> <span class="n">NumpyStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">xstruct</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[17]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>NumpyStruct(shape=(10, 20), refcount=1)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see that we've pulled out the correct shape information.  Let's make sure the reference count is correct:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">]</span>  <span class="c1"># add three more references to x</span>
<span class="n">xstruct</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[18]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>NumpyStruct(shape=(10, 20), refcount=4)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can do the tricky part of pulling out the data buffer. For simplicity we'll ignore the strides and assume it's a C-contiguous array; this could be generalized with a bit of work.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">xstruct</span> <span class="o">=</span> <span class="n">NumpyStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">xstruct</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># assume an array of integers</span>
<span class="n">arraytype</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">arraytype</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">xstruct</span><span class="o">.</span><span class="n">ob_data</span><span class="p">)</span>

<span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[19]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>data</code> variable is now a view of the contiguous block of memory defined in the NumPy array!  To show this, we'll change a value in the array...</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">555</span>
<span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[20]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[0, 1, 2, 3, 555, 5, 6, 7, 8, 9]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>... and observe that the data view changes as well.  Both <code>x</code> and <code>data</code> are pointing to the same contiguous block of memory.</p>
<p>Comparing the internals of the Python list and the NumPy ndarray, it is clear that NumPy's arrays are <strong>much, much</strong> simpler for representing a list of identically-typed data. That fact is related to what makes it more efficient for the compiler to handle as well.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Just-for-fun:-a-few-&quot;never-use-these&quot;-hacks">Just for fun: a few "never use these" hacks<a class="anchor-link" href="#Just-for-fun:-a-few-&quot;never-use-these&quot;-hacks">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using <code>ctypes</code> to wrap the C-level data behind Python objects allows you to do some pretty interesting things. With proper attribution to my friend James Powell, I'll say it here: <a href="http://seriously.dontusethiscode.com/">seriously, don't use this code</a>. While nothing below should actually be used (ever), I still find it all pretty interesting!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modifying-the-Value-of-an-Integer">Modifying the Value of an Integer<a class="anchor-link" href="#Modifying-the-Value-of-an-Integer">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Inspired by <a href="http://www.reddit.com/r/Python/comments/2441cv/can_you_change_the_value_of_1/">this Reddit post</a>, we can actually modify the numerical value of integer objects! If we use a common number like <code>0</code> or <code>1</code>, we're very likely to crash our Python kernel. But if we do it with less important numbers, we can get away with it, at least briefly.</p>
<p>Note that this is a <em>really, really</em> bad idea. In particular, if you're running this in an IPython notebook, you might corrupt the IPython kernel's very ability to run (because you're screwing with the variables in its runtime). Nevertheless, we'll cross our fingers and give it a shot:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># WARNNG: never do this!</span>
<span class="n">id113</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="mi">113</span><span class="p">)</span>
<span class="n">iptr</span> <span class="o">=</span> <span class="n">IntStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">id113</span><span class="p">)</span>
<span class="n">iptr</span><span class="o">.</span><span class="n">ob_digit</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># now Python&#39;s 113 contains a 4!</span>

<span class="mi">113</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[21]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But note now that we can't set the value back in a simple manner, because the true value <code>113</code> no longer exists in Python!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">113</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[22]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>4</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="mi">112</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[23]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>4</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>One way to recover is to manipulate the bytes directly. We know that $113 = 7 \times 16^1 + 1 * 16^0$, so <strong>on a little-endian 64-bit system running Python 3.4</strong>, the following should work:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">id113</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char</span><span class="p">))[</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x71</span><span class="s1">&#39;</span>
<span class="mi">112</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[24]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>113</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and we're back!</p>
<p>Just in case I didn't stress it enough before: <strong>never do this.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="In-place-Modification-of-List-Contents">In-place Modification of List Contents<a class="anchor-link" href="#In-place-Modification-of-List-Contents">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Above we did an in-place modification of a value in a numpy array. This is easy, because a numpy array is simply a data buffer. But might we be able to do the same thing for a list? This gets a bit more tricky, because lists store <em>references</em> to values rather than the values themselves. And to not crash Python itself, you need to be very careful to keep track of these reference counts as you muck around.  Here's how it can be done:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># WARNING: never do this!</span>
<span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">]</span>
<span class="n">Lwrapper</span> <span class="o">=</span> <span class="n">ListStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>
<span class="n">item_address</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="n">Lwrapper</span><span class="o">.</span><span class="n">ob_item</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;before:&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>

<span class="c1"># change the c-pointer of the list item</span>
<span class="n">item_address</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># we need to update reference counts by hand</span>
<span class="n">IntStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span><span class="o">.</span><span class="n">ob_refcnt</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="n">IntStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">.</span><span class="n">ob_refcnt</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;after: &quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>before: [42]
after:  [6]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Like I said, you should never use this, and I honestly can't think of any reason why you would want to. But it gives you an idea of the types of operations the interpreter has to do when modifying the contents of a list. Compare this to the NumPy example above, and you'll see one reason why Python lists have more overhead than Python arrays.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Meta-Goes-Meta:-a-self-wrapping-Python-object">Meta Goes Meta: a self-wrapping Python object<a class="anchor-link" href="#Meta-Goes-Meta:-a-self-wrapping-Python-object">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using the above methods, we can start to get even stranger. The <code>Structure</code> class in <code>ctypes</code> is itself a Python object, which can be seen in <a href="http://hg.python.org/cpython/file/3.4/Modules/_ctypes/ctypes.h#l46">Modules/_ctypes/ctypes.h</a>. Just as we wrapped ints and lists, we can wrap structures themselves as follows:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CStructStruct</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">Structure</span><span class="p">):</span>
    <span class="n">_fields_</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;ob_refcnt&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_type&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;ob_ptr&quot;</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_long</span><span class="p">),</span>  <span class="c1"># char* pointer cast to long</span>
                    <span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;CStructStruct(ptr=0x</span><span class="si">{self.ob_ptr:x}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;refcnt=</span><span class="si">{self.ob_refcnt}</span><span class="s2">)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we'll attempt to make a structure that wraps itself. We can't do this directly, because we don't know at what address in memory the new structure will be created. But what we can do is create a <em>second</em> structure wrapping the first, and use this to modify its contents in-place!</p>
<p>We'll start by making a temporary meta-structure and wrapping it:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="n">IntStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">CStructStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">meta</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>CStructStruct(ptr=0x10023ef00, refcnt=1)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we add a third structure, and use it to adjust the memory value of the second in-place:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">meta_wrapper</span> <span class="o">=</span> <span class="n">CStructStruct</span><span class="o">.</span><span class="n">from_address</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">meta</span><span class="p">))</span>
<span class="n">meta_wrapper</span><span class="o">.</span><span class="n">ob_ptr</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">ob_ptr</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">meta</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">meta</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>True
CStructStruct(ptr=0x106d828c8, refcnt=7)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We now have a self-wrapping Python structure!</p>
<p>Again, I can't think of any reason you'd ever want to do this. And keep in mind there is noting groundbreaking about this type of self-reference in Python  due to its dynamic typing, it is realatively straightforward to do things like this without directly hacking the memory:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[[...]]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Conclusion">Conclusion<a class="anchor-link" href="#Conclusion">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Python is slow. And one big reason for that, as we've seen, is the type indirection under the hood which makes Python quick, easy, and fun for the developer.  And as we've seen, Python itself offers tools that can be used to hack into the Python objects themselves.</p>
<p>I hope that this was made more clear through this exploration of the differences between various objects, and some liberal mucking around in the internals of CPython itself. This exercise was extremely enlightening for me, and I hope it was for you as well...  Happy hacking!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>This blog post was written entirely in the IPython Notebook.  The full notebook can be downloaded
<a href="http://jakevdp.github.io/downloads/notebooks/WhyPythonIsSlow.ipynb">here</a>,
or viewed statically
<a href="http://nbviewer.ipython.org/url/jakevdp.github.io/downloads/notebooks/WhyPythonIsSlow.ipynb">here</a>.</em></p>

</div>
</div>
</div>
 


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
        </div>

        <div class="meta">
            <div>
                    <a href="http://jakevdp.github.io/tag/python.html" class="tag">python</a>
                    <a href="http://jakevdp.github.io/tag/tutorial.html" class="tag">tutorial</a>
                    <a href="http://jakevdp.github.io/tag/ctypes.html" class="tag">ctypes</a>
            </div>
        </div>
    </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
    <script type="text/javascript">
      var disqus_shortname = 'pythonicperambulations';
      var disqus_identifier = '/blog/2014/05/09/why-python-is-slow/';
      var disqus_url = 'http://jakevdp.github.io/blog/2014/05/09/why-python-is-slow/';
      var disqus_title = 'Why Python is Slow: Looking Under the Hood';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
  </section>

</div>

<style type="text/css">
{
    max-width: 700px;
}

.text_cell .prompt {
    display: none;
}

div.cell {
    padding: 0;
}

div.text_cell_render {
    padding: 0;
}

div.prompt {
    font-size: 13px;
}

div.input_prompt {
    padding: .7em 0.2em;
}

div.output_prompt {
    padding: .4em .2em;
}

div.input_area {
    margin: .2em 0.4em;
    max-width: 580px;
}

table.dataframe {
    font-family: Arial, sans-serif;
    font-size: 13px;
    line-height: 20px;
}

table.dataframe th, td {
    padding: 4px;
    text-align: left;
}

pre code {
    background-color: inherit;
}</style>

        </div>
<!--
    <footer>
      <p>
         2012-2017 Jake VanderPlas, license <a href="https://github.com/jakevdp/jakevdp.github.io-source/blob/master/LICENSE"> </a>
        unless otherwise noted.
        Generated by <a href= "http://docs.getpelican.com/">Pelican</a>.
      </p>
    </footer>
-->
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34061646-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34061646-1');
    ga('send', 'pageview');
</script>
    </body>
</html>